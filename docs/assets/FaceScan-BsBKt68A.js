import{S as M,D as S,_ as D,u as T,a as U,b as G,c as B,r as u,o as C,n as p,d as v,e as f,f as o,g as R,T as x,h as L}from"./index-C6UcR6dN.js";function A(g,l){return l===void 0&&(l=new M),new S(g,l)}const N={class:"scan-page"},O={class:"scan-container"},E={class:"video-container"},I={class:"button-container"},W=["disabled"],P={key:0,class:"overlay"},V={__name:"FaceScan",setup(g){const l=T(),w=U(),s=G(),r=B(),_=u(null),m=u(!0),c=u(!1),i=u(null);C(async()=>{_.value=l.params.id,await k(),await y()});async function k(){try{const e=await navigator.mediaDevices.getUserMedia({video:{facingMode:"user"}});i.value.srcObject=e}catch(e){console.error("Gagal mengakses kamera:",e),s.error("Tidak dapat mengakses kamera.",{timeout:3e3})}}async function y(){const e="http://localhost:5000/models";try{await Promise.all([p.tinyFaceDetector.loadFromUri(e),p.faceLandmark68Net.loadFromUri(e),p.faceRecognitionNet.loadFromUri(e)])}catch(a){console.error("Gagal memuat model:",a),s.error("Gagal memuat model deteksi wajah.",{timeout:3e3})}finally{m.value=!1}}async function b(){if(m.value){s.info("Model masih dimuat, tunggu sebentar…",{timeout:2e3});return}c.value=!0;try{if(await A(i.value,new x({inputSize:224,scoreThreshold:.5}))){const a=document.createElement("canvas");a.width=i.value.videoWidth,a.height=i.value.videoHeight,a.getContext("2d").drawImage(i.value,0,0);const n=a.toDataURL("image/jpeg");await j(n)}else c.value=!1,s.error("Wajah tidak terdeteksi. Memuat ulang halaman…",{timeout:2e3}),setTimeout(()=>window.location.reload(),2e3)}catch(e){c.value=!1,console.error("Gagal mendeteksi wajah:",e),s.error("Gagal mendeteksi wajah. Memuat ulang halaman…",{timeout:2e3}),setTimeout(()=>window.location.reload(),2e3)}}async function j(e){var a;try{const n=F(e),t=new FormData;t.append("nama",r.data.nama),t.append("hp",r.data.hp),t.append("instansi",r.data.instansi),t.append("tujuan",r.data.tujuan),t.append("keperluan",r.data.keperluan),t.append("foto",n,"face.jpg"),await L.post("http://localhost:5000/api/pengunjung",t,{headers:{"Content-Type":"multipart/form-data"}}),s.success("Data dan wajah berhasil disimpan!",{timeout:3e3}),r.reset(),w.push("/sukses")}catch(n){c.value=!1,console.error("Gagal upload data:",((a=n.response)==null?void 0:a.data)||n.message),s.error("Gagal mengunggah data. Memuat ulang halaman…",{timeout:2e3}),setTimeout(()=>window.location.reload(),2e3)}}function F(e){const a=e.split(","),n=a[0].match(/:(.*?);/)[1],t=atob(a[1]);let d=t.length;const h=new Uint8Array(d);for(;d--;)h[d]=t.charCodeAt(d);return new Blob([h],{type:n})}return(e,a)=>(f(),v("div",N,[o("div",O,[a[1]||(a[1]=o("h1",{class:"title"},"Scan Wajah Anda",-1)),o("div",E,[o("video",{ref_key:"video",ref:i,autoplay:"",muted:"",playsinline:"",width:"100%",height:"auto"},null,512)]),o("div",I,[o("button",{onClick:b,class:"scan-button",disabled:m.value}," Ambil Foto & Simpan ",8,W),c.value?(f(),v("div",P,a[0]||(a[0]=[o("div",{class:"spinner"},null,-1),o("p",null,"Memindai wajah, mohon tunggu...",-1)]))):R("",!0)])])]))}},H=D(V,[["__scopeId","data-v-ed85004d"]]);export{H as default};

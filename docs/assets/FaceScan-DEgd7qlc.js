import{S as F,D as M,_ as T,u as D,a as S,b as U,r as u,o as G,n as m,c as v,d as f,e as o,f as B,T as C,g as R}from"./index-CVm1uFTA.js";function x(g,r){return r===void 0&&(r=new F),new M(g,r)}const L={class:"scan-page"},A={class:"scan-container"},N={class:"video-container"},O={class:"button-container"},W=["disabled"],E={key:0,class:"overlay"},I={__name:"FaceScan",setup(g){const r=D(),w=S(),n=U(),h=u(null),d=u(!0),l=u(!1),s=u(null);G(async()=>{h.value=r.params.id,await _(),await y()});async function _(){try{const e=await navigator.mediaDevices.getUserMedia({video:{facingMode:"user"}});s.value.srcObject=e}catch(e){console.error("Gagal mengakses kamera:",e),n.error("Tidak dapat mengakses kamera.",{timeout:3e3})}}async function y(){const e="http://localhost:5000/models";try{await Promise.all([m.tinyFaceDetector.loadFromUri(e),m.faceLandmark68Net.loadFromUri(e),m.faceRecognitionNet.loadFromUri(e)])}catch(a){console.error("Gagal memuat model:",a),n.error("Gagal memuat model deteksi wajah.",{timeout:3e3})}finally{d.value=!1}}async function b(){if(d.value){n.info("Model masih dimuat, tunggu sebentar…",{timeout:2e3});return}l.value=!0;try{if(await x(s.value,new C({inputSize:224,scoreThreshold:.5}))){const a=document.createElement("canvas");a.width=s.value.videoWidth,a.height=s.value.videoHeight,a.getContext("2d").drawImage(s.value,0,0);const t=a.toDataURL("image/jpeg");await k(t)}else l.value=!1,n.error("Wajah tidak terdeteksi. Memuat ulang halaman…",{timeout:2e3}),setTimeout(()=>window.location.reload(),2e3)}catch(e){l.value=!1,console.error("Gagal mendeteksi wajah:",e),n.error("Gagal mendeteksi wajah. Memuat ulang halaman…",{timeout:2e3}),setTimeout(()=>window.location.reload(),2e3)}}async function k(e){var a;try{const t=j(e),i=new FormData;i.append("image",t,"face.jpg"),i.append("pengunjung_id",h.value),await R.post("http://localhost:5000/api/upload-face",i,{headers:{"Content-Type":"multipart/form-data"}}),n.success("Wajah berhasil disimpan!",{timeout:3e3}),w.push("/sukses")}catch(t){l.value=!1,console.error("Gagal upload wajah:",((a=t.response)==null?void 0:a.data)||t.message),n.error("Gagal mengunggah wajah. Memuat ulang halaman…",{timeout:2e3}),setTimeout(()=>window.location.reload(),2e3)}}function j(e){const a=e.split(","),t=a[0].match(/:(.*?);/)[1],i=atob(a[1]);let c=i.length;const p=new Uint8Array(c);for(;c--;)p[c]=i.charCodeAt(c);return new Blob([p],{type:t})}return(e,a)=>(f(),v("div",L,[o("div",A,[a[1]||(a[1]=o("h1",{class:"title"},"Scan Wajah Anda",-1)),o("div",N,[o("video",{ref_key:"video",ref:s,autoplay:"",muted:"",playsinline:"",width:"100%",height:"auto"},null,512)]),o("div",O,[o("button",{onClick:b,class:"scan-button",disabled:d.value}," Ambil Foto & Simpan ",8,W),l.value?(f(),v("div",E,a[0]||(a[0]=[o("div",{class:"spinner"},null,-1),o("p",null,"Memindai wajah, mohon tunggu...",-1)]))):B("",!0)])])]))}},z=T(I,[["__scopeId","data-v-a45a87b2"]]);export{z as default};
